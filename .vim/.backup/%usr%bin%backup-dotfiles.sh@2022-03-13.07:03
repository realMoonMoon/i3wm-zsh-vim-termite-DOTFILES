#!/bin/bash


# check to see is git command line installed in this machine
IS_GIT_AVAILABLE="$(git --version)"
if [[ $IS_GIT_AVAILABLE == *"version"* ]]; then
  echo "Git is Available"
else
  echo "Git is not installed"
  exit 1
fi

cd $HOME

# Create dirs
mkdir -p BACKUP/.config/termite
mkdir -p BACKUP/.config/i3
mkdir -p BACKUP/.config/i3status
mkdir -p BACKUP/.ssh
mkdir -p BACKUP/CERT
mkdir -p BACKUP/work
# copy dotfiles

cp -r .vimrc .zshrc .zsh_history .Xresources .gitconfig BACKUP 
cp -r .zsh_custom BACKUP
cp -r .vim BACKUP
cp -r .ssh BACKUP
cp -r CERT BACKUP
cp -r work BACKUP
cp .config/termite/config BACKUP/.config/termite
cp .config/i3/config BACKUP/.config/i3
cp .config/i3/i3status.sh BACKUP/.config/i3
cp .config/i3status/config BACKUP/.config/i3status

while getopts ":d" option; do
   case $option in
      d) # Remove sensitive files from BACKUP folder
         rm -f BACKUP/.vim/view/*
         rm -f BACKUP/.vim/.backup/*
         rm -rf BACKUP/CERT
         rm -rf BACKUP/work
         rm -f BACKUP/.ssh/id*
         rm -f BACKUP/.ssh/bastion-vilja*
         exit;;
   esac
done

cd BACKUP

# Check git status
gs="$(git status | grep -i "modified")"
echo "${gs}"

# If there is a ncp -r .zshrc .zsh_history .zsh_custom .Xresources .vimrc .vim .config/termite/config .config/i3/config .config/i3/i3status.sh .config/i3status/config .ssh BACKUPew change
if [[ $gs == *"modified"* ]]; then
  echo "push"
fi


# push to Github
git add -u;
git commit -m "New backup `date +'%Y-%m-%d %H:%M:%S'`";
git push origin master
