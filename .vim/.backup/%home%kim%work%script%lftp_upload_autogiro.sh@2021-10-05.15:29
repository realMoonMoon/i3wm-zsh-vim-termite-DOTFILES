#!/bin/bash
# Set SFTP user, password and host
SFTP_USER='fedelta01'
SFTP_PASS="CyGkOCLgMGt7MOBIXg07XjcEh2"
SFTP_HOST='sftp-loadbalancer.lfp-public'
SSHOPT="-e sftp -o PubkeyAuthentication=no -o StrictHostKeyChecking=no -o BatchMode=no -b -"
export SSHPASS="$SFTP_PASS"

###
### Upload  && autogiro file to nordiska lftp
###
[ ! -d "/tmp/IPFE-ToNordiska-Autogiro" ] && mkdir /tmp/IPFE-ToNordiska-Autogiro
cd /tmp/IPFE-ToNordiska-Autogiro

echo -e "get /IPFE-ToNordiska-Autogiro/BFEP.IAGAG.K0367056*\nrm /IPFE-ToNordiska-Autogiro/BFEP.IAGAG.K0367056*\n" |/usr/bin/sshpass $SSHOPT $SFTP_USER'@'$SFTP_HOST >&- 2>&-
STATUS="$?"
[[ $STATUS == '0' ]]   && { echo -n "Downloaded $(ls BFEP.IAGAG.K0367056*), "; }
[[ $STATUS == '1' ]]   && { echo "Download failed, no file found at $DOWNLOAD_HOST:/tmp/"; exit 0; }
[[ $STATUS == '5' ]]   && { echo "Authentication failed for $DOWNLOAD_USER'@'$DOWNLOAD_HOST"; exit 1; }
[[ $STATUS == '255' ]] && { echo "Could not resolve hostname $DOWNLOAD_HOST"; exit 1; }

if [[ $STATUS -eq 0 ]];then
    lftp -u ipfe_script_test,Viie9514Aa99,er -e "set ftp:ssl-protect-data true set ftp:ssl-force true set ssl:verify-certificate no" coreftp.nordiskacore.com:21638:/TestFilesGoHere/IPFE-ToNordiska-Autogiro <<- UPLOAD
mput BFEP.IAGAG.K0367056* 
UPLOAD
    if [[ $? -eq 0 ]]; then
        rm /tmp/IPFE-ToNordiska-Autogiro/BFEP.IAGAG.K0367056*
        echo "File uploaded to Nordiska SFTP"
    else
        echo "Could not upload autogiro file to lftp"
    fi
fi

