#!/bin/bash
# Set SFTP user, password and host
SFTP_USER='fedelta01'
SFTP_PASS="CyGkOCLgMGt7MOBIXg07XjcEh2"
SFTP_HOST='sftp-loadbalancer.lfp-public'
SSHOPT="-e sftp -o PubkeyAuthentication=no -o StrictHostKeyChecking=no -o BatchMode=no -b -"
export SSHPASS="$SFTP_PASS"

###
### Download BGMax file
###
[ ! -d "/tmp/IPFE-FromNordiska-BGmax" ] && mkdir /tmp/IPFE-FromNordiska-BGmax
cd /tmp/IPFE-FromNordiska-BGmax 
lftp -u ipfe_script,bMYtr77miTTonG73 -e "set ftp:ssl-protect-data true set ftp:ssl-force true set ssl:verify-certificate no" coreftp.nordiskacore.com:21538 <<- DOWNLOAD
mget -E /TestFilesGoHere/IPFE-FromNordiska-BGmax/BFEP*
DOWNLOAD

if [ ! $? -eq 0 ]; then
    echo "$(date "+%d/%m/%Y-%T") Cant download files from PFE-FromNordiska-BGmax. Make sure the credentials and server information are correct"
else
# Remove file from lftp
    lftp -u ipfe_script,bMYtr77miTTonG73 -e "set ftp:ssl-protect-data true set ftp:ssl-force true set ssl:verify-certificate no" coreftp.nordiskacore.com:21538 <<- REMOVE
mrm /TestFilesGoHere/IPFE-FromNordiska-BGmax/BFEP*
REMOVE

### Upload BGMax to our sftp

export SSHPASS="$SFTP_PASS"
echo -e "put BFEP*\n" |/usr/bin/sshpass $SSHOPT $SFTP_USER'@'$SFTP_HOST:/IPFE-FromNordiska-BGmax/ >&- 2>&-
STATUS="$?"
[[ $STATUS == '0' ]]   && { echo -n "Uploaded file successfully to our SFTP"; rm -rf /tmp/IPFE-FromNordiska-BGmax; }
[[ $STATUS == '1' ]]   && { echo "Upload failed, no file found"; exit 1; }
[[ $STATUS == '5' ]]   && { echo "Authentication failed for $UPLOAD_USER'@'$UPLOAD_HOST"; exit 1; }
[[ $STATUS == '255' ]] && { echo "Could not resolve hostname $UPLOAD_HOST"; exit 1; }
fi


