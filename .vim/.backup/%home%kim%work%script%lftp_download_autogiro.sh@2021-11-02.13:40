#!/bin/bash
# Set SFTP user, password and host
SFTP_USER='fedelta01'
SFTP_PASS="LmpYNMK!XeTnOFfmhC0!Gzat06011O1P"
SFTP_HOST='sftp-loadbalancer.lfp-public'
SSHOPT="-e sftp -o PubkeyAuthentication=no -o StrictHostKeyChecking=no -o BatchMode=no -b -"
export SSHPASS="$SFTP_PASS" 


###
### Download Autogiro file
###

[ ! -d "/tmp/IPFE-FromNordiska-Autogiro" ] && mkdir /tmp/IPFE-FromNordiska-Autogiro
cd /tmp/IPFE-FromNordiska-Autogiro
lftp -u ipfe_script,bMYtr77miTTonG73 -e "set ftp:ssl-protect-data true set ftp:ssl-force true set ssl:verify-certificate no" coreftp.nordiskacore.com:21538 <<- DOWNLOAD
mget -E /IPFE-FromNordiska-Autogiro/Vilja/AUTOGIROMEDGIVANDEN*
DOWNLOAD

if [ ! $? -eq 0 ]; then
    echo "$(date "+%d/%m/%Y-%T") Cant download files from IPFE-FromNordiska-Autogiro. Make sure the credentials and server information are correct"
else
# Remove file from lftp
    lftp -u ipfe_script,bMYtr77miTTonG73 -e "set ftp:ssl-protect-data true set ftp:ssl-force true set ssl:verify-certificate no" coreftp.nordiskacore.com:21638 <<- REMOVE
mrm /IPFE-FromNordiska-Autogiro/Vilja/AUTOGIROMEDGIVANDEN*
REMOVE
   
# Upload Autogiro file to our sftp 

export SSHPASS="$SFTP_PASS"
echo -e "put AUTOGIROMEDGIVANDEN*\n" |/usr/bin/sshpass $SSHOPT $SFTP_USER'@'$SFTP_HOST:/IPFE-FromNordiska-Autogiro/ >&- 2>&-
STATUS="$?"
[[ $STATUS == '0' ]]   && { echo -n "Uploaded file successfully to our SFTP "; rm -rf /tmp/IPFE-FromNordiska-Autogiro; }
[[ $STATUS == '1' ]]   && { echo "Upload failed, no file found"; exit 1; }
[[ $STATUS == '5' ]]   && { echo "Authentication failed for $UPLOAD_USER'@'$UPLOAD_HOST"; exit 1; }
[[ $STATUS == '255' ]] && { echo "Could not resolve hostname $UPLOAD_HOST"; exit 1; }
fi

